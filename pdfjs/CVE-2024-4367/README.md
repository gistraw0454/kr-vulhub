# CVE-2024-4367
| whs 3기 이유진

## 개요
PDF.js는 HTML5로 구축된 PDF(Portable Document Format) 뷰어입니다.

4.1.392 이전 PDF.js 버전에서 JavaScript 코드 삽입 취약점이 발견되었습니다. 이 취약점을 악용하여 공격자는 악성 PDF 파일을 여는 즉시 임의의 JavaScript 코드를 실행할 수 있습니다.

## 환경 구축

### docker-compose.yml
```
version: '2'
services:
 web:
   image: vulhub/pdfjs:4.1.392
   volumes:
    - ./index.php:/var/www/html/index.php
   ports:
    - "8080:80"
```

### 테스트 환경 만들기
```
docker compose up -d
```

### index.php
PDF 파일을 업로드 받고, 업로드가 완료되면 PDF.js 뷰어를 통해 업로드한 파일을 볼 수 있도록 리다이렉트 시키는 간단한 파일 업로드 페이지를 구현하였다.
```php
<?php
if (!empty($_FILES)):

// Check for errors
if($_FILES['file_upload']['error'] > 0){
    die('An error ocurred when uploading.');
}

// Check filesize
if(!is_uploaded_file($_FILES['file_upload']['tmp_name'])) {
    die('File is not uploaded file');
}

$ext = pathinfo($_FILES['file_upload']['name'], PATHINFO_EXTENSION);
if ($ext !== 'pdf') {
    die('Unsupported filetype uploaded.');
}

$new_name = uniqid() . '.pdf';
if(!move_uploaded_file($_FILES['file_upload']['tmp_name'], __DIR__ . '/upload/' . $new_name)){
    die('Error uploading file - check destination is writeable.');
}

header('Location: /web/viewer.html?file=../upload/' . $new_name, true, 302);
exit;
else:
?>
<form method="post" enctype="multipart/form-data">
    File: <input type="file" name="file_upload">
    <input type="submit">
</form>
<?php
endif;
```

- `header('Location: /web/viewer.html?file=../upload/' . $new_name, true, 302);` 부분을 통해 브라우저를 `/seb/viewer.html`로 리다이렉트한다.
- `enctype="multipart/form-data"` 설정을 통해 파일 업로드를 할 수 있도록 한다.
    - 파일 저장위치는 `upload/` 이고, `uniqid()`를 통해 고유 ID를 사용한다.


## PoC

## 출처
https://github.com/vulhub/vulhub/tree/master/pdfjs/CVE-2024-4367
